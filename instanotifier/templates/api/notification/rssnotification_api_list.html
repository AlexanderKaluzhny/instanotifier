{% extends "base.html" %}

{% load staticfiles %}
{% load bootstrap_pagination %}

{% block css %}
  {{ block.super }}
  <link href="{% static 'css/notification-list.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
  <span id="date-list-url" data-url="{% url 'api-v1:rssnotification-date-list'%}"></span>
  <span id="date-list-filtering-url" data-url="{% url 'api-v1:rssnotification-list' %}" data-filter-param="?published_parsed__date="></span>
  <span id="filter_date_used" data-date="{{ filter_date_used }}"></span>
  <span id="rating-url" data-url="{% url 'api-v1:rssnotification-rating' %}"></span>

  <div class="row notification-list-page-header">
    {% if paginator %}
        {% bootstrap_paginate paginator.page range=10 %}
    {% endif %}

    {% if filter_form %}
    <button style="float: right; " data-toggle="modal" data-target="#filtersModal"
            class="btn btn-default">
      <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
      Search
    </button>
    {% endif %}
  </div>

  <div class="row">
    <div class="col-md-9 notification-list">
      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        {% for notification in results %}
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="notification-heading-{{ forloop.counter }}">
              <h4 class="panel-title">
                <div class="row">
                  <div class="col-md-8">
                    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#notification-data-{{ forloop.counter }}" aria-expanded="false" aria-controls="notification-data-{{ forloop.counter }}">
                      {{ notification.title }} - {{ notification.rating }}
                      </p>{{ notification.published_parsed }}
                    </a>
                  </div>
                  <div class="col-md-4">
                    <div class="rating-buttons" data-notification-id="{{ notification.id }}">
                      <button class="submit btn btn-default" data-action="upvoted">Upvote</button>
                      <button class="submit btn btn-default" data-action="downvoted">Downvote</button>
                      <button class="submit btn btn-default" data-action="default">Clear</button>
                    </div>
                  </div>
                </div>
              </h4>
            </div>
            <div id="notification-data-{{ forloop.counter }}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="notification-heading-{{ forloop.counter }}">
              <div class="panel-body">
                  {{ notification.summary|safe }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="col-md-3 notification-date-list">
      <div id="date-list" class="list-group">
      </div>
    </div>
  </div>

  {% if filter_form %}
    {{ filter_form }}
  {% endif %}

{% endblock content %}

{% block javascript %}
{{ block.super }}
  <script>$('#accordion .collapse').collapse('hide');</script>
  <script type="text/javascript" src="{% static 'js/notification-date-list.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/notification-list-rating.js' %}"></script>
{% endblock %}
